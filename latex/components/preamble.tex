% Layout
\usepackage[a4paper,top=2cm,bottom=2cm]{geometry}
\usepackage[colorlinks]{hyperref}
% \usepackage[allbordercolors={1 0 0}]{hyperref}
% \usepackage[hidelinks]{hyperref}
\usepackage{lastpage}       % ``n of m'' page numbering
\usepackage{pdflscape} % to allow some pages to be landscaped, with \begin{landscape}
\usepackage{parskip}
\usepackage{multicol}
\usepackage{caption}  % for manual captions within multicol

% File management
\usepackage{subfiles}
\usepackage{zref-xr} % for references to labels across subfiles

% Font
\usepackage[normalem]{ulem} % strikethrough
\usepackage[soul]{lua-ul} % for highlighting via \hl and underline via \ul. LuaLaTeX version of soul ourtesy of https://tex.stackexchange.com/a/586053
\usepackage{luacolor}  % LuaLaTeX version of soul courtesy of https://tex.stackexchange.com/a/586053


% Figures
\usepackage{float}

% Tables
\usepackage{booktabs}
\usepackage{multirow}
\usepackage{longtable}

% Colours
\usepackage{xcolor}
\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codebg}{rgb}{0.96, 0.96, 0.96}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{codered}{rgb}{1, 0.9, 0.9}
\newcommand{\textorange}[1]{\textcolor{orange}{#1}}
\newcommand{\textred}[1]{\textcolor{red}{#1}}
\newcommand{\exception}[1]{\textcolor{red}{\textbf{\hl{#1}}}}
\newcommand{\exceptiong}[1]{\textcolor{red}{\textbf{\phantom{あ}\hl{#1}\phantom{あ}}}}  % g for guard
\usepackage{microtype}
\newcommand{\textwhite}[1]{\textcolor{white}{#1}}
\newcommand{\textblue}[1]{\textcolor{blue}{#1}}
\newcommand{\textgreen}[1]{\textcolor{codegreen}{#1}}
\newcommand{\textpurple}[1]{\textcolor{codepurple}{#1}}
\newcommand{\textlightgrey}[1]{\textcolor{lightgray}{#1}}
\newcommand{\textgrey}[1]{\textcolor{gray}{#1}}
\newcommand{\textblack}[1]{\textcolor{black}{#1}}

% Basic LaTeX structures
\usepackage{enumitem} % For custom enumerate

% Description Labels
% Coutesy of https://tex.stackexchange.com/a/1248
\makeatletter
\let\orgdescriptionlabel\descriptionlabel
\renewcommand*{\descriptionlabel}[1]{%
    \let\orglabel\label
    \let\label\@gobble
    \phantomsection
    \edef\@currentlabel{#1\unskip}%
    %\edef\@currentlabelname{#1}%
    \let\label\orglabel
    \orgdescriptionlabel{#1}%
}
\makeatother

% Miscellaneous
\usepackage{pxrubrica}  % Support for ふりがな
\rubysetup{j}  % Jukugo ruby by default, use | to separate word boundaries if available
\usepackage{siunitx}
\usepackage{nicefrac}
\usepackage{amssymb}  % for \lessapprox
\usepackage{cancel}
\newcommand{\aux}{\textsc{aux}}
\newcommand{\prefix}{\textsc{prefix}}
\newcommand{\suffix}{\textsc{suffix}}
\newcommand{\htc}{\textsc{\textbf{HTC}}}
\usepackage{tikz}
\usetikzlibrary{patterns}
\usepackage[no-test-for-array]{nicematrix}  % no-test-for-array is a hack to allow the Docker image to run successfully; this is necessary with the use of nicematrix package
\newcommand{\transbothequal}{\Block[transparent, tikz={pattern = crosshatch, pattern color = gray!10}]{1-*}{}}
\newcommand{\transboth}{\Block[transparent, tikz={pattern = grid, pattern color = gray!10}]{1-*}{}}

% Rename sections for \documentclass{ltjarticle}
% \renewcommand{\figurename}{Figure} % ltjarticle overrides this to
\renewcommand{\tablename}{Table} % ltjarticle overrides this to 表 (ひょう)
\renewcommand{\contentsname}{Contents} % ltjarticle overrides this to 表 (ひょう)

% Heading
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhf{}
\lhead{\textbf{ジャッキー・カン}\\kung.jwe@gmail.com}
\rhead{\textbf{日本語\ruby{学習}{がく|しゅう}\ruby{教材}{きょう|ざい}}}
% \rhead{\textbf{日本語\ruby{学習}{ガク|シュウ}\ruby{教材}{キョウ|ザイ}}}
% Date formatting courtesy of https://tex.stackexchange.com/a/638289
\usepackage{datetime2}
\DTMnewstyle{myformat}{
    \renewcommand*\DTMdisplay[9]{
        \DTMtwodigits{##1}\DTMtwodigits{##2}\DTMtwodigits{##3} \DTMtwodigits{##5}\DTMtwodigits{##6}\DTMtwodigits{##7}
    }
}{}{}{}
\ifcsname currentdatestring\endcsname
    \chead{\textlightgrey{\currentdatestring}}
\else
    \chead{\textlightgrey{\DTMsetstyle{myformat} \DTMnow}}
\fi
\setlength{\headheight}{24.10pt}  % Adjust according to compilation warnings
\cfoot{Page \thepage\ of \pageref{LastPage}}
\renewcommand{\headrulewidth}{0.5pt}
\renewcommand{\footrulewidth}{0.5pt}
